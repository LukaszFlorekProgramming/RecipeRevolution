@using RecipeRevolutionBlazor.Services.Users
@inherits LayoutComponentBase
@inject AuthTokenService TokenService
@inject NavigationManager NavigationManager

<body class="container-fluid">
    <header class="d-flex flex-wrap align-items-center justify-content-md-between py-3 mb-4 border-bottom">
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Recipe Revolution</a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a href="#" class="nav-link px-2 link-secondary">Home</a></li>
                        <li class="nav-item"><a href="HomeRecipes" class="nav-link px-2 link-dark">Recipes</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <form class="d-flex" @onsubmit="HandleSearch">
            <input class="form-control me-2" type="search" placeholder="Search recipe" aria-label="Search" @bind="@searchQuery">
            <button class="btn btn-outline-success" type="submit">Search</button>
        </form>

        <div class="d-flex justify-content-end">
        @if (!string.IsNullOrEmpty(TokenService.Token))
        {
            <span class="nav-link">Welcome, @TokenService.GetUserNameFromToken() !</span>
            <ul class="nav col-12 col-md-auto mb-2 mb-md-0">
                <li><a href="Myrecipes" class="nav-link px-2 link-secondary">My Recipes</a></li>
                
            </ul>
            <button type="button" class="btn btn-warning" @onclick="Logout">Wyloguj</button>
        }
        else
        {
             <button type="button" class="btn btn-outline-primary me-2" @onclick="() => RedirectToLoginPage()">Login</button>
             <button type="button" class="btn btn-primary" @onclick="() => RedirectToRegisterPage()">Sign-up</button>
        }
        </div>

    </header>
    <menu>
        <article class="content px-3">
            @Body
        </article>
    </menu>
    <footer class="py-3 my-4">
        <ul class="nav justify-content-center border-bottom pb-3 mb-3">
            <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Home</a></li>
            <li class="nav-item"><a href="HomeRecipes" class="nav-link px-2 text-muted">Recipes</a></li>
        </ul>
        <p class="text-center text-muted">© 2023 Łukasz Florek. All rights reserved.</p>
    </footer>

</body>

@code {
    private string searchQuery;

    private void HandleSearch()
    {
        NavigationManager.NavigateTo($"/RecipeSearch/{searchQuery}");
    }


    private void Logout()
    {
        TokenService.RemoveToken();
        NavigationManager.NavigateTo("/HomeRecipes");
    }

    private void RedirectToLoginPage()
    {
        NavigationManager.NavigateTo($"/login");
    }

    private void RedirectToRegisterPage()
    {
        NavigationManager.NavigateTo($"/register");
    }
    private void RedirectToSearchPage()
    {
        NavigationManager.NavigateTo($"/recipes");
    }



}